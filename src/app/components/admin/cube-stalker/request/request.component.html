<p-card>
  <div class="mb-5">
    <p-button label="Retour" icon="pi pi-arrow-left" [text]="true" routerLink="../" />
  </div>
  @if (!requestLoading && cardRequest() === null) {
    <p-message severity="info" icon="pi pi-info-circle">
      La demande d'image de carte Cube-Stalker recherchée n'existe pas.
    </p-message>
  } @else if (cardRequest(); as cardRequest) {
    <div class="mb-5">
      <h3 class="mt-0">Auteur·rice de la demande</h3>
      @if (requestLoading()) {
        <div class="flex items-center">
          <p-skeleton shape="circle" size="42px" class="me-4" />
          <p-skeleton width="10rem" />
        </div>
      } @else if (cardRequest !== null) {
        <div class="flex items-center">
          <p-avatar
            [image]="cardRequest.member.avatar"
            class="flex me-4"
            size="large"
            shape="circle" />
          <span>
            {{ cardRequest.member.name }}
          </span>
        </div>
      }
    </div>
    <div class="mb-5">
      <h3 class="mt-0">Status de la demande</h3>
      @if (requestLoading()) {
        <p-skeleton width="5rem" height="1.5rem"></p-skeleton>
      } @else if (cardRequest !== null) {
        <p-tag
          [value]="getStatusName(cardRequest.status)"
          [severity]="getStatusSeverity(cardRequest.status)" />
      }
    </div>
    <div>
      <h3 class="mt-0">Aperçu</h3>
      <div class="w-full aspect-5/2 pointer-events-none">
        @if (cardLoading()) {
          <p-skeleton width="100%" height="100%" />
        } @else if (memberCard(); as memberCard) {
          <img [src]="'data:image/webp;base64,' + memberCard.preview" class="w-full h-full" />
        }
      </div>
    </div>
    <div class="flex items-center gap-x-4 mt-6">
      <p-button
        label="Refuser"
        severity="danger"
        class="ms-auto"
        icon="pi pi-ban"
        [disabled]="!canSave()"
        [loading]="saving()"
        (onClick)="confirmDeny($event, cardRequest.member.id)" />
      <p-button
        label="Approuver"
        severity="success"
        icon="pi pi-verified"
        [disabled]="!canSave()"
        [loading]="saving()"
        (onClick)="confirmApproval($event, cardRequest.member.id)" />
    </div>
  }
</p-card>
<p-confirmDialog key="card-request-dialog" appendTo="body" [dismissableMask]="true" />
